{% extends "base.html" %}
{% block content %}
<div class="form-container">
  <h2 style="text-align: center; margin-top: 0; margin-bottom: 30px;">Record Patient Vitals</h2>
  <form method="POST">
    <div class="form-grid">
      <div class="form-column">
        <div>
          <label>Select Patient:</label>
          <select name="patient_id" required>
            <option value="">--Select--</option>
            {% for patient in patients %}
              <option value="{{ patient.id }}">{{ patient.patient_code }} - {{ patient.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label>Blood Pressure (e.g., 120/80):</label>
          <input type="text" name="blood_pressure" required>
        </div>
        <div>
          <label>Temperature (°C):</label>
          <input type="number" step="0.1" name="temperature" required>
        </div>
         <div>
          <label>Pulse Rate (bpm):</label>
          <input type="number" name="pulse_rate" required>
        </div>
      </div>
      <div class="form-column">
        <div>
          <label>Weight (kg):</label>
          <input type="number" step="0.1" name="weight" required>
        </div>
        <div>
          <label>Height (cm):</label>
          <input type="number" step="0.1" name="height" required>
        </div>
        <div>
          <label>BMI (kg/m²):</label>
          <input type="text" name="bmi" readonly>
        </div>
        <div>
          <label>BSA (m²):</label>
          <input type="text" name="bsa" readonly>
        </div>
      </div>
    </div>
    <div style="text-align: center;">
      <button type="submit">Save Vitals</button>
    </div>
  </form>
  <a href="{{ url_for('dashboard') }}" class="back-link">← Back to Dashboard</a>
</div>

<script>
  const weightInput = document.querySelector('input[name="weight"]');
  const heightInput = document.querySelector('input[name="height"]');
  const bmiInput = document.querySelector('input[name="bmi"]');
  const bsaInput = document.querySelector('input[name="bsa"]');

  function calculateMetrics() {
    const weight = parseFloat(weightInput.value);
    const height = parseFloat(heightInput.value);
    
    if (weight > 0 && height > 0) {
      const heightInMeters = height / 100;
      const bmi = (weight / (heightInMeters ** 2)).toFixed(2);
      bmiInput.value = bmi;

      const bsa = Math.sqrt((height * weight) / 3600).toFixed(2);
      bsaInput.value = bsa;

    } else {
      bmiInput.value = '';
      bsaInput.value = '';
    }
  }

  weightInput.addEventListener('input', calculateMetrics);
  heightInput.addEventListener('input', calculateMetrics);
</script>
{% endblock %}
